{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "03e606d1_6213017a",
        "filename": "suspend/1.0/default/SystemSuspend.cpp",
        "patchSetId": 11
      },
      "lineNbr": 279,
      "author": {
        "id": 1409782
      },
      "writtenOn": "2020-11-01T05:17:17Z",
      "side": 1,
      "message": "Tested on bramble I saw the following logs:\n11-01 06:25:51.142  6141  6141 I suspend ns: 642601308470\tsuspend cycles:      13050424193\n11-01 06:25:51.142    76    76 I PM      : Start suspend monitor\n11-01 06:26:51.247  6141  6141 I PM      : suspend exit 2020-11-01 06:26:51.247906792 UTC\n11-01 06:26:51.247  6141  6141 I PM      : suspend exit\n11-01 06:26:51.248    76    76 I PM      : Stop suspend monitor\n11-01 06:26:51.248   582  6141 E android.system.suspend@1.0-service: suspend s\u003d1 oh\u003d152049182 t\u003d60035318206\n11-01 06:26:51.248   582  6141 E android.system.suspend@1.0-service: failed to read wakeup reasons\n11-01 06:26:51.248  1900  3181 I BatteryStatsService: In wakeup_callback: resumed from suspend\n11-01 06:26:51.348  6141  6141 I PM      : suspend entry 2020-11-01 06:26:51.348479041 UTC\n11-01 06:26:51.348  6141  6141 I PM      : suspend entry (deep)\n11-01 06:26:51.349    76    76 I PM      : Start suspend monitor\n11-01 06:26:51.384     8     8 I [kworke][0x34ececcdd][06:26:51.384682] wlan: [8:I:HDD] hdd_suspend_wlan: 1168: WLAN being suspended by OS\n11-01 06:26:51.431  6141  6141 I [Binder][0x34edc998a][06:26:51.431785] wlan: [6141:I:HDD] __wlan_hdd_bus_suspend: 1038: starting bus suspend\n11-01 06:26:51.431  6141  6141 I [Binder][0x34edca40e][06:26:51.431924] wlan: [6141:I:WMI] suspend type: WOW_IFACE_PAUSE_DISABLED\n11-01 06:26:51.436  6141  6141 I [Binder][0x34ede1ceb][06:26:51.436949] wlan: [6141:I:HDD] __wlan_hdd_bus_suspend: 1101: bus suspend succeeded\n11-01 06:26:51.462    76    76 I PM      : Stop suspend monitor\n11-01 06:26:51.462  6141  6141 I suspend ns: 642885710241\tsuspend cycles:      14208565173\n11-01 06:26:51.462    76    76 I PM      : Start suspend monitor\n11-01 06:27:01.892   582  6141 E android.system.suspend@1.0-service: suspend s\u003d1 oh\u003d167866840 t\u003d10357507235\n11-01 06:27:01.892   582  6141 E android.system.suspend@1.0-service: failed to read wakeup reasons\n\nA few potential problems observed:\n1. \"suspend ns\" message doesn\u0027t seem to align with output of sysfs node, mainly the time spent in suspend. Am I misunderstanding something?\n2. 11-01 06:26:51.248   582  6141 E android.system.suspend@1.0-service: failed to read wakeup reasons seems to indicate that the service is failing to read from the wakeup reasons.\ncat /sys/kernel/wakeup_reasons/last_resume_reason                                                                                                   \n-1 misconfigured IRQ 191 smp2p\nshows there are wakeup reasons to parse. What is going on there?",
      "range": {
        "startLine": 278,
        "startChar": 12,
        "endLine": 279,
        "endChar": 67
      },
      "revId": "fd9df61c79744dd0445684ad4c5809424bbf6d28",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0bd3e2fa_76813ad2",
        "filename": "suspend/1.0/default/SystemSuspend.cpp",
        "patchSetId": 11
      },
      "lineNbr": 279,
      "author": {
        "id": 1409782
      },
      "writtenOn": "2020-11-01T05:38:15Z",
      "side": 1,
      "message": "michaelfsun@ do you think you know what might be going wrong with 2?",
      "parentUuid": "03e606d1_6213017a",
      "range": {
        "startLine": 278,
        "startChar": 12,
        "endLine": 279,
        "endChar": 67
      },
      "revId": "fd9df61c79744dd0445684ad4c5809424bbf6d28",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2d75aaa5_c2c36f7a",
        "filename": "suspend/1.0/default/SystemSuspend.cpp",
        "patchSetId": 11
      },
      "lineNbr": 279,
      "author": {
        "id": 1729155
      },
      "writtenOn": "2020-11-02T05:16:40Z",
      "side": 1,
      "message": "The wake reason reading operation does not parse or filter. It can only be:\n1. wakeup reason file is empty.\n2. sysfs read operation failed. \n\nAs 2. is very unlikely, I assume it is the kernel failed to provide a wakeup reason. And SystemSuspend will push back a \"unknown\" reason into the reason vector.",
      "parentUuid": "0bd3e2fa_76813ad2",
      "range": {
        "startLine": 278,
        "startChar": 12,
        "endLine": 279,
        "endChar": 67
      },
      "revId": "fd9df61c79744dd0445684ad4c5809424bbf6d28",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d48515c6_ffbb79f2",
        "filename": "suspend/1.0/default/SystemSuspend.cpp",
        "patchSetId": 11
      },
      "lineNbr": 279,
      "author": {
        "id": 1409782
      },
      "writtenOn": "2020-11-02T05:44:21Z",
      "side": 1,
      "message": "Sounds good. I do think it is odd that the wakeup reason is blank when it is read by the suspend service but when I do adb shell cat /sys/kernel/wakeup_reasons/last_resume_reason I see data. But either case it doesn\u0027t seem to affect this particular CL.  Thank you for clarifying this.\n\nRegarding 1 the \"suspend ns\" comes from sched_clock.c and is the value of sched_clock, not the amount of time spent in suspend. So 1 is not an issue.",
      "parentUuid": "2d75aaa5_c2c36f7a",
      "range": {
        "startLine": 278,
        "startChar": 12,
        "endLine": 279,
        "endChar": 67
      },
      "revId": "fd9df61c79744dd0445684ad4c5809424bbf6d28",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "fe767f3f_1dc1a29f",
        "filename": "suspend/1.0/default/SystemSuspend.cpp",
        "patchSetId": 11
      },
      "lineNbr": 279,
      "author": {
        "id": 1499410
      },
      "writtenOn": "2020-11-02T16:20:31Z",
      "side": 1,
      "message": "Good to know about suspend ns. Thanks for digging into this Ben.",
      "parentUuid": "d48515c6_ffbb79f2",
      "range": {
        "startLine": 278,
        "startChar": 12,
        "endLine": 279,
        "endChar": 67
      },
      "revId": "fd9df61c79744dd0445684ad4c5809424bbf6d28",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3b5b0cb5_ebfca9ab",
        "filename": "suspend/1.0/default/SystemSuspend.cpp",
        "patchSetId": 11
      },
      "lineNbr": 279,
      "author": {
        "id": 1241955
      },
      "writtenOn": "2020-11-02T23:23:11Z",
      "side": 1,
      "message": "As a totally orthogonal note, the \"-1 misconfigured IRQ 191 smp2p\" message means that after getting QC to fix it multiple times for previous devices, they are once again setting this interrupt as both IRQF_NO_SUSPEND and enable_irq_wake(), which is an invalid IRQ configuration in nearly all cases (including theirs).\n\nThe read failures are concerning to me, since I\u0027m responsible for the kernel code behind that sysfs node.  I could see it happening if the suspend service went to read the reasons right as a new suspend was starting, since the existing reasons are cleared when a PM_SUSPEND_PREPARE event goes out.  But looking at the timestamps, that isn\u0027t what happened here.\n\n\nBen, if you do testing again that produces these read errors, can you grab a bugreport and share it with me?  I\u0027d love to see the entire set of kernel and system log messages surrounding the resumes where the wakeup reason reading fails.\n\n(clearing \"resolved\" just for visibility; feel free to close)",
      "parentUuid": "fe767f3f_1dc1a29f",
      "range": {
        "startLine": 278,
        "startChar": 12,
        "endLine": 279,
        "endChar": 67
      },
      "revId": "fd9df61c79744dd0445684ad4c5809424bbf6d28",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "20da33f2_685f46f0",
        "filename": "suspend/1.0/default/SystemSuspend.cpp",
        "patchSetId": 11
      },
      "lineNbr": 279,
      "author": {
        "id": 1409782
      },
      "writtenOn": "2020-11-03T00:31:26Z",
      "side": 1,
      "message": "I can collect a bug report after adding some additional logs we can discuss in a separate thread",
      "parentUuid": "3b5b0cb5_ebfca9ab",
      "range": {
        "startLine": 278,
        "startChar": 12,
        "endLine": 279,
        "endChar": 67
      },
      "revId": "fd9df61c79744dd0445684ad4c5809424bbf6d28",
      "serverId": "85c56323-6fa9-3386-8a01-6480fb634889"
    }
  ]
}